<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ranking • Show do Crentão</title>
  <style>
    :root{ --bg:#000; --panel:#0b0f0f; --text:#fff; --muted:#a9b5b3; --outline:1px solid rgba(255,255,255,.08) }
    *{box-sizing:border-box} html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto}
    main{max-width:900px;margin:32px auto;padding:0 20px}
    .card{background:rgba(12,15,15,.78);border:var(--outline);border-radius:14px;padding:18px}
    h1{margin:0 0 12px} .muted{color:var(--muted);margin:0 0 16px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.06);text-align:left}
    th{font-size:14px;color:#cfe6e1}
    a.btn{display:inline-block;margin:16px 0 0;padding:10px 16px;border-radius:999px;background:#121515;border:1px solid rgba(255,255,255,.1);color:#eaf6f3;text-decoration:none}
  </style>
</head>
<body>
  <main>
    <div class="card">
      <h1>Ranking</h1>
      <p class="muted">Maiores pontuações registradas.</p>
      <table><thead>
        <tr><th>#</th><th>Jogador</th><th>Pontos</th><th>Talentos</th><th>Quando</th></tr>
      </thead><tbody id="rows"><tr><td colspan="5">Carregando…</td></tr></tbody></table>
      <a href="index.html" class="btn">← Voltar</a>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL  = 'https://ihajmegcdgwchxslnaep.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImloYWptZWdjZGd3Y2h4c2xuYWVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0OTQzMTgsImV4cCI6MjA3MjA3MDMxOH0.WM36lA9n0PU9qd-DKdrWVB_UzGVXpsfJ984oHiXDU8Y';
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    (async function load(){
      const tbody = document.getElementById('rows');
      try{
        let { data, error } = await sb
          .from('ranking')
          .select('nome,pontos,tesouro,quando')
          .order('tesouro', { ascending:false })
          .limit(100);

        if(error || !data){
          const r2 = await sb.from('best_score')
            .select('nome,pontos,tesouro,atualizado_em')
            .order('tesouro', { ascending:false })
            .limit(100);
          if(!r2.error) data = (r2.data||[]).map(r=>({nome:r.nome,pontos:r.pontos,tesouro:r.tesouro,quando:r.atualizado_em}));
        }

        if(!data || !data.length){ tbody.innerHTML = '<tr><td colspan="5">Sem resultados ainda.</td></tr>'; return; }
        tbody.innerHTML = data.map((r,i)=>`
          <tr>
            <td>${i+1}</td>
            <td>${r.nome || 'Convidado'}</td>
            <td>${r.pontos ?? 0}</td>
            <td>${(r.tesouro ?? 0).toLocaleString('pt-BR')}</td>
            <td>${r.quando ? new Date(r.quando).toLocaleString('pt-BR') : '-'}</td>
          </tr>
        `).join('');
      }catch(e){
        tbody.innerHTML = '<tr><td colspan="5">Erro ao carregar ranking.</td></tr>';
      }
    })();
  </script>
</body>
</html>
